<div class="row">
  <div class="col-md-8" id="canvas-holder">
    <canvas id="longest-titles-chart-area"/>
    <div id="legendDiv"></div>
  </div>
  <% i = 1 %>
  <% for sound in @longestTitleSounds do %>
    <div class="col-md-4">
      <%= link_to "#{i}: "+sound.title[0..40].gsub(/\s\w+\s*$/, '...'), sound.permalink_url %>
    </div>
    <% i += 1 %>
  <% end %>
</div>

<%= javascript_tag do %>

  var trackLabels = [];
  var trackDownloads = [];
  var trackFavoritings = [];
  var trackComments = [];
  var trackPlays = [];
  <% for sound in @longestTitleSounds do %>
    trackLabels.push("<%= sound.title[0..14] %>");
    trackDownloads.push(<%= sound.download_count %>);
    trackFavoritings.push(<%= sound.favoritings_count %>);
    trackComments.push(<%= sound.comment_count %>);
    trackPlays.push(<%= sound.playback_count %>);
  <% end %>
  var barChartData = {
    labels : trackLabels,
    datasets : [
      {
        label: "Downloads",
        fillColor : "rgba(220,220,220,0.5)",
        strokeColor : "rgba(220,220,220,0.8)",
        highlightFill: "rgba(220,220,220,0.75)",
        highlightStroke: "rgba(220,220,220,1)",
        data : trackDownloads
      },
      {
        label: "Favoritings",
        fillColor : "rgba(151,187,205,0.5)",
        strokeColor : "rgba(151,187,205,0.8)",
        highlightFill : "rgba(151,187,205,0.75)",
        highlightStroke : "rgba(151,187,205,1)",
        data : trackFavoritings
      },
      {
        label: "Comments",
        fillColor : "rgba(151,187,205,0.5)",
        strokeColor : "rgba(151,187,205,0.8)",
        highlightFill : "rgba(151,187,205,0.75)",
        highlightStroke : "rgba(151,187,205,1)",
        data : trackComments
      },
      {
        label: "Plays",
        fillColor : "rgba(151,187,205,0.5)",
        strokeColor : "rgba(151,187,205,0.8)",
        highlightFill : "rgba(151,187,205,0.75)",
        highlightStroke : "rgba(151,187,205,1)",
        data : trackPlays
      }
    ]
  }

  window.onload = function(){
    var ctx = document.getElementById("longest-titles-chart-area").getContext("2d");
    window.myBar = new Chart(ctx).Bar(barChartData, {
      responsive : true,
      multiTooltipTemplate: "<%%= datasetLabel %>: <%%= value %>"
    });
    document.getElementById("legendDiv").innerHTML = window.myBar.generateLegend();
  }

<% end %>